<%- include('../partials/head') %>
<%- include('../partials/header') %>

<section class="container section checkout-page" data-animate="fade">
  <h2 class="section-title" data-animate="fade-up">ğŸ’³ Thanh toÃ¡n</h2>

  <form action="/checkout" method="post" class="checkout-form glass-box" data-animate="fade-up" data-duration="700">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>"/>

    <div class="grid2">
      <div class="checkout-left">
        <h3 class="step-title" data-animate="fade">1ï¸âƒ£ ThÃ´ng tin giao hÃ ng</h3>
        <label>Há» tÃªn
          <input name="full_name" required placeholder="Nguyá»…n VÄƒn A"/>
        </label>
        <label>Sá»‘ Ä‘iá»‡n thoáº¡i
          <input name="phone" required placeholder="090xxxxxxx"/>
        </label>
        <label>Äá»‹a chá»‰
          <input name="address_line1" required placeholder="Sá»‘ nhÃ , tÃªn Ä‘Æ°á»ng..."/>
        </label>

        <div class="grid3">
          <label>Tá»‰nh/TP<input name="province" placeholder="TP. Há»“ ChÃ­ Minh"/></label>
          <label>Quáº­n/Huyá»‡n<input name="district" placeholder="Quáº­n 1"/></label>
          <label>PhÆ°á»ng/XÃ£<input name="city" placeholder="PhÆ°á»ng Báº¿n NghÃ©"/></label>
        </div>

        <h3 class="step-title" data-animate="fade-up">2ï¸âƒ£ PhÆ°Æ¡ng thá»©c váº­n chuyá»ƒn</h3>
        <div class="shipping-options">
          <label><input type="radio" name="shipping_method" value="standard" checked/> ğŸšš TiÃªu chuáº©n (2â€“4 ngÃ y) â€” 20.000â‚«</label>
          <label><input type="radio" name="shipping_method" value="express"/> âš¡ Há»a tá»‘c (1â€“2 ngÃ y) â€” 50.000â‚«</label>
        </div>
      </div>

      <div class="checkout-right" data-animate="fade-up" data-delay="100">
        <h3 class="step-title">3ï¸âƒ£ Thanh toÃ¡n</h3>
        <label><input type="radio" name="payment_method" value="cod" checked/> ğŸ’µ Thanh toÃ¡n khi nháº­n hÃ ng (COD)</label>
        <label><input type="radio" name="payment_method" value="bank_transfer"/> ğŸ¦ Chuyá»ƒn khoáº£n ngÃ¢n hÃ ng</label>
        <label><input type="radio" name="payment_method" value="vnpay"/> ğŸ’³ VNPay</label>

        <h3 class="step-title" style="margin-top:1rem;">ğŸ§¾ TÃ³m táº¯t Ä‘Æ¡n hÃ ng</h3>
        <ul class="order-items">
          <% items.forEach(it => { %>
            <li>
              <img src="<%= it.image_url || '/public/img/placeholder.png' %>" class="thumb"/>
              <span><%= it.product_name %> Ã— <%= it.quantity %></span>
              <strong><%= (Number(it.price_at)*it.quantity).toLocaleString() %>â‚«</strong>
            </li>
          <% }) %>
        </ul>

        <div class="summary-line"><span>Táº¡m tÃ­nh:</span><strong><%= subtotal.toLocaleString() %>â‚«</strong></div>
        <div class="summary-line"><span>PhÃ­ ship:</span><strong id="ship-fee">20,000â‚«</strong></div>
        <div class="summary-line total"><span>Tá»•ng cá»™ng:</span><strong id="total"><%= (subtotal + 20000).toLocaleString() %>â‚«</strong></div>

        <button class="btn btn-primary w-full" type="submit" data-animate="zoom-in">âœ… Äáº·t hÃ ng</button>
      </div>
    </div>
  </form>
</section>

<%- include('../partials/footer') %>

<script>
  // ğŸ§® TÃ­nh láº¡i tá»•ng khi chá»n phÆ°Æ¡ng thá»©c giao hÃ ng
  const radios = document.querySelectorAll('input[name="shipping_method"]');
  const subtotal = Number('<%= subtotal %>');
  const totalEl = document.getElementById('total');
  const shipFeeEl = document.getElementById('ship-fee');

  radios.forEach(r => r.addEventListener('change', () => {
    let ship = r.value === 'express' ? 50000 : 20000;
    shipFeeEl.innerText = ship.toLocaleString() + 'â‚«';
    totalEl.innerText = (subtotal + ship).toLocaleString() + 'â‚«';
  }));
</script>

<style>
  /* CSS cá»§a báº¡n á»Ÿ Ä‘Ã¢y... (giá»¯ nguyÃªn khÃ´ng Ä‘á»•i) */
  .checkout-page { max-width: 1100px; margin: 2rem auto; }
  .glass-box {
    background: rgba(255,255,255,0.08);
    border: 1px solid var(--border);
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    backdrop-filter: blur(10px);
  }
  .checkout-form label {
    display: block;
    margin-bottom: .8rem;
    font-weight: 500;
  }
  
  /* === ÄÃƒ XÃ“A QUY Táº®C input, select VÃ€ input:focus, select:focus VÃŒ ÄÃƒ CÃ“ TRONG main.css === */
  
  .step-title {
    font-size: 1.2rem;
    color: var(--primary);
    margin: 1.2rem 0 .6rem;
  }
  .shipping-options label {
    display: block;
    padding: .4rem 0;
  }
  .checkout-right {
    background: rgba(255,255,255,0.05);
    padding: 1.4rem 1.8rem;
    border-radius: .8rem;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
  }
  .order-items {
    list-style: none;
    padding: 0;
    margin: 1rem 0;
  }
  .order-items li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border);
    padding: .5rem 0;
  }
  .order-items .thumb {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border-radius: .3rem;
    margin-right: .6rem;
  }
  .summary-line {
    display: flex;
    justify-content: space-between;
    margin: .4rem 0;
    font-size: 1rem;
  }
  .summary-line.total {
    font-size: 1.15rem;
    font-weight: 600;
    color: var(--primary-700);
  }
  .w-full { width: 100%; margin-top: 1rem; }
  @media (prefers-color-scheme: dark) {
    .glass-box { background: rgba(255,255,255,0.05); }
    /* === ÄÃƒ XÃ“A QUY Táº®C input, select á» CHáº¾ Äá»˜ Tá»I === */
  }
  @media (max-width: 768px) {
    .grid2 { grid-template-columns: 1fr; }
    .checkout-right { margin-top: 2rem; }
  }
</style>