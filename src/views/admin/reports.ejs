<%- include('./layout') %>

<div class="admin-content">
  <h1 data-animate="fade">üìä B√°o c√°o & Th·ªëng k√™</h1>

  <div class="stats-grid" data-animate="fade-up">
    <div class="stat-card">
      <h3>Doanh thu th√°ng</h3>
      <div class="value"><%= (report && report.monthlyRevenue ? report.monthlyRevenue : 0).toLocaleString() %>‚Ç´</div>
    </div>
    <div class="stat-card">
      <h3>ƒê∆°n h√†ng m·ªõi</h3>
      <div class="value"><%= (report && report.newOrders) || 0 %></div>
    </div>
    <div class="stat-card">
      <h3>Kh√°ch h√†ng m·ªõi</h3>
      <div class="value"><%= (report && report.newCustomers) || 0 %></div>
    </div>
    <div class="stat-card">
      <h3>S·∫£n ph·∫©m s·∫Øp h·∫øt</h3>
      <div class="value"><%= (report && report.lowStock) || 0 %></div>
    </div>
  </div>

  <div data-animate="zoom-in" style="margin-top:2rem;">
    <canvas id="revenueChart" height="120"></canvas>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(function () {
  // ‚úÖ L·∫•y d·ªØ li·ªáu an to√†n t·ª´ server (n·∫øu thi·∫øu th√¨ d√πng m·∫£ng r·ªóng)
const labels = JSON.parse('<%- JSON.stringify((report && report.labels) || []) %>');
const values = JSON.parse('<%- JSON.stringify((report && report.values) || []) %>');

  const el = document.getElementById('revenueChart');
  if (!el) return;

  const ctx = el.getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Doanh thu (‚Ç´)',
        data: values,
        borderColor: '#1976d2',
        backgroundColor: 'rgba(25,118,210,0.15)',
        tension: 0.3,
        fill: true,
        pointRadius: 3,
        pointHoverRadius: 5,
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: function(ctx){
              const v = Number(ctx.parsed.y || 0);
              return ' ' + v.toLocaleString() + '‚Ç´';
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(v){ return Number(v).toLocaleString() + '‚Ç´'; }
          },
          grid: { color: 'rgba(0,0,0,0.06)' }
        },
        x: { grid: { display: false } }
      }
    }
  });
})();
</script>
