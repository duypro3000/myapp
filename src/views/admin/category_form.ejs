<% 
  const isEditMode = !!category.id;
  const formAction = isEditMode 
    ? `/admin/categories/edit/${category.id}` 
    : '/admin/categories/new';
%>

<section class="container section admin-page" data-animate="fade">
  <h2 class="section-title" data-animate="fade-up">
    <%= isEditMode ? '‚úèÔ∏è C·∫≠p nh·∫≠t danh m·ª•c' : '‚ûï Th√™m danh m·ª•c m·ªõi' %>
  </h2>

  <form action="<%= formAction %>" method="POST" class="admin-form-grid" data-animate="fade-up" data-delay="100">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>"/>

    <!-- Main content -->
    <div class="main-content">
      <div class="admin-card glass-box">
        <div class="form-group">
          <label for="name">T√™n danh m·ª•c</label>
          <input type="text" id="name" name="name" value="<%= category.name || '' %>" required>
        </div>

        <div class="form-group">
          <label for="slug">Slug (URL)</label>
          <input type="text" id="slug" name="slug" 
                 value="<%= category.slug || '' %>" 
                 placeholder="ƒê·ªÉ tr·ªëng ƒë·ªÉ t·ª± ƒë·ªông t·∫°o (khuy√™n d√πng)">
        </div>
        
        <div class="form-group">
          <label for="description">M√¥ t·∫£</label>
          <textarea id="description" name="description" rows="5"><%= category.description || '' %></textarea>
        </div>
        
        <div class="form-group">
          <label for="image_url">·∫¢nh ƒë·∫°i di·ªán</label>
          <input type="text" id="image_url" name="image_url" 
                 value="<%= category.image_url || '' %>" 
                 placeholder="https://...">
          <% if (category.image_url) { %>
            <img src="<%= category.image_url %>" class="form-image-preview" alt="Preview">
          <% } %>
        </div>
      </div>
    </div>

    <!-- Sidebar content -->
    <div class="sidebar-content">
      <div class="admin-card glass-box">
        <div class="form-group">
          <label for="is_active">Tr·∫°ng th√°i</label>
          <select id="is_active" name="is_active">
            <option value="true" <%= category.is_active ? 'selected' : '' %>>üü¢ Ho·∫°t ƒë·ªông (Hi·ªÉn th·ªã)</option>
            <option value="false" <%= !category.is_active ? 'selected' : '' %>>üî¥ ·∫®n (Kh√¥ng hi·ªÉn th·ªã)</option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary w-full">
          <%= isEditMode ? 'üíæ C·∫≠p nh·∫≠t' : '‚úÖ Th√™m m·ªõi' %>
        </button>

        <% if (isEditMode) { %>
          <a href="/admin/categories" class="btn btn-outline w-full" style="margin-top:.5rem;">‚¨Ö Tr·ªü v·ªÅ danh s√°ch</a>
        <% } %>
      </div>

      <div class="admin-card glass-box">
        <div class="form-group">
          <label for="parent_id">Danh m·ª•c cha</label>
          <select id="parent_id" name="parent_id">
            <option value="">-- (Kh√¥ng c√≥) --</option>
            <% allCats.forEach(cat => { %>
              <% if (!isEditMode || cat.id !== category.id) { %>
                <option value="<%= cat.id %>" <%= (category.parent_id == cat.id) ? 'selected' : '' %>>
                  <%= cat.name %>
                </option>
              <% } %>
            <% }); %>
          </select>
        </div>

        <div class="form-group">
          <label for="sort_order">Th·ª© t·ª± s·∫Øp x·∫øp</label>
          <input type="number" id="sort_order" name="sort_order" 
                 value="<%= category.sort_order || 0 %>" 
                 placeholder="0 = m·∫∑c ƒë·ªãnh">
          <small class="muted">S·ªë nh·ªè h∆°n hi·ªÉn th·ªã tr∆∞·ªõc.</small>
        </div>
      </div>
    </div>
  </form>
</section>
